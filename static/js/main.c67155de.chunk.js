(this["webpackJsonptwitch-bot"]=this["webpackJsonptwitch-bot"]||[]).push([[0],{103:function(t,e,n){},104:function(t,e,n){},108:function(t,e,n){},116:function(t,e){},175:function(t,e,n){},184:function(t,e,n){},185:function(t,e,n){"use strict";n.r(e);var a=n(2),s=n.n(a),c=n(93),i=n.n(c),r=n(36),o=(n(103),n(9)),u=n(10),l=n(13),h=n(12),d=(n(104),n(31)),p=n.n(d),b=n(4),j=n(45),m=n(24),f=n(23),g=n(94),O=n(98),v=n(39),x=1,y=2,k=3,w=function(){function t(e){var n=this;Object(o.a)(this,t),this.updateLastMessageTime=function(t){n.lastMessageTimes=Object(b.a)(Object(b.a)({},n.lastMessageTimes),{},Object(f.a)({},t,Date.now()))},this.minsSinceLastChatMessage=function(t){return Math.floor((Date.now()-n.lastMessageTimes[t])/6e4)},this.getChatters=function(){return v("https://thingproxy.freeboard.io/fetch/https://tmi.twitch.tv/group/user/".concat(n.channel,"/chatters")).then((function(t){return t.json()})).then((function(t){return t&&t.chatters?[].concat(Object(m.a)(t.chatters.moderators),Object(m.a)(t.chatters.viewers),Object(m.a)(t.chatters.staff),Object(m.a)(t.chatters.admins),Object(m.a)(t.chatters.global_mods)):null})).catch((function(t){return null}))},this.channel=e,this.lastMessageTimes={},this.getStatus=this.getStatus.bind(this)}return Object(u.a)(t,[{key:"getStatus",value:function(){var t=Object(j.a)(p.a.mark((function t(e){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==this.channel){t.next=2;break}return t.abrupt("return",x);case 2:if(!(this.lastMessageTimes[e]&&this.minsSinceLastChatMessage(e)<10)){t.next=4;break}return t.abrupt("return",x);case 4:return t.abrupt("return",this.getChatters().then((function(t){return t&&t.includes(e)?y:k})));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),C=(n(108),n.p+"static/media/lock.6857c469.svg"),S=n(3),M=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).getFormattedTimeDiff=function(t){var e="minute",n=Math.floor((Date.now()-t)/6e4);return 0===n?"just now":(n>=60&&(e="hour",(n=Math.floor(n/60))>=24&&(e="day",n=Math.floor(n/24))),"".concat(n," ").concat(e).concat(1===n?"":"s"," ago"))},a.updateStatus=function(){a.props.getActivity(a.props.metadata.username).then((function(t){a.setState((function(){return Object(b.a)(Object(b.a)({},a.state),{},{timeDiff:a.getFormattedTimeDiff(a.props.metadata.time),activityStatus:t})}))}))},a.delete=function(t){a.props.onDelete(a.props.msg)},a.toggleLock=function(){a.props.toggleLock(a.props.msg)},a.getTooltipContents=function(){var t="";switch(a.state.activityStatus){case x:t="active";break;case y:t="idle";break;case k:t="disconnected"}return'\n      <div class="tooltip">\n        <p class="tooltipText">Requested '.concat(a.state.timeDiff," by ").concat(a.props.metadata.username,'</p>\n        <div class="status ').concat(t,'" />\n      </div>')},a.state={timeDiff:0,activityStatus:null},a}return Object(u.a)(n,[{key:"render",value:function(){var t=this.props.metadata.locked?"1":"0.2",e=this.props.metadata.chosen?"chosen":"pending";return Object(S.jsxs)("div",{children:[Object(S.jsx)(O.a,{effect:"solid",place:"right"}),Object(S.jsx)("div",{id:"baseDiv",className:e,"data-tip":this.getTooltipContents(),"data-html":!0,onMouseEnter:this.updateStatus,children:Object(S.jsxs)("div",{style:{margin:"0px 15px 7px",padding:"4px",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[this.props.msg,Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsx)("img",{src:C,alt:"lock",style:{width:"16px",opacity:t,paddingRight:"8px"},className:"lock",onClick:this.toggleLock}),Object(S.jsx)("button",{type:"button",className:"deleteButton",onClick:this.delete,children:"X"})]})]})})]})}}]),n}(a.Component),G=n(68),T=n(47),_=n.n(T),q=n.p+"static/media/JackboxGames.3e1fec84.yaml",D=n(39),L=n(114),N="!request",F=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).filterGameCommands=function(t,e){if("!gamelist"===t.trim()&&a.sendMessage("/me @".concat(e,", click here for a list of valid Jackbox games: ").concat("https://asukii314.github.io/twitch-request-wheel/#","/gamelist")),t.startsWith(N)){var n=t.replace(N,"").trim().toLowerCase();for(var s in a.state.validGames)for(var c=a.state.validGames[s],i=0,r=Object.entries(c);i<r.length;i++){var o=Object(G.a)(r[i],2),u=o[0];if(o[1].includes(n))return"".concat(u," (").concat(s,")")}return a.sendMessage("/me @".concat(e,", ").concat(n," could not be found in the list of valid Jackbox games. Click here for a list of valid games: ").concat("https://asukii314.github.io/twitch-request-wheel/#","/gamelist")),null}},a.onMessage=function(t,e,n,s){if(!s){a.props.onMessage(n,e.username,e);var c=a.filterGameCommands(n,e.username);if(c)if(a.props.messages[c])a.sendMessage("/me @".concat(e.username,", ").concat(c," has already been requested!"));else{for(var i=null,r=0,o=Object.entries(a.props.messages);r<o.length;r++){var u=Object(G.a)(o[r],2),l=u[0];if(u[1].username===e.username){i=l;break}}i?a.props.channel===e.username?a.sendMessage("/me @".concat(e.username,", ").concat(c," has been added to the request queue. Your previous game request(s) weren't deleted, since you have special broadcaster privilege :P")):(a.props.onDelete(i),a.sendMessage("/me @".concat(e.username,", your previous request of ").concat(i," has been replaced with ").concat(c,"."))):a.sendMessage("/me @".concat(e.username,", ").concat(c," has been added to the request queue.")),a.props.addGame(c,e.username)}}},a.sendMessage=function(t){a.state.client.say(a.props.channel,t)},a.state={client:null,validGames:[]},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(t){var e=this,n=new L.client({identity:{username:this.props.channel,password:this.props.access_token},channels:[this.props.channel]});n.on("message",this.onMessage),n.connect(),D(q).then((function(t){return t.text()})).then((function(t){e.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{client:n,validGames:_.a.parse(t)})}))}))}},{key:"render",value:function(){return null}}]),n}(a.Component),z=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).goForward=function(){a.state.index!==a.props.history.length-1&&a.setState((function(t){return Object(b.a)(Object(b.a)({},a.state),{},{index:a.state.index+1})}))},a.goBackward=function(){a.state.index<=0||a.setState((function(t){return Object(b.a)(Object(b.a)({},a.state),{},{index:a.state.index-1})}))},a.printGame=function(t){return t===a.state.index?Object(S.jsx)("b",{style:{color:"aquamarine"},children:a.props.history[t]}):a.props.history[t]},a.state={index:0},a}return Object(u.a)(n,[{key:"render",value:function(){var t=this;return Object(S.jsxs)("div",{style:{marginLeft:"12px",width:"33%",textTransform:"capitalize"},children:[Object(S.jsx)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"1px",marginBottom:"10px"},children:Object(S.jsxs)("p",{style:{fontSize:"14px",fontWeight:"700",height:"70px",padding:"8px"},children:[" Up Next:",this.props.history.length>this.state.index&&Object(S.jsx)("p",{children:this.props.history[this.state.index]})]})}),Object(S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(S.jsx)("button",{onClick:this.goBackward,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginRight:"5px"},children:" \ud83e\udca0 "}),Object(S.jsx)("button",{onClick:this.goForward,style:{backgroundColor:"darkcyan",borderRadius:"5px",marginTop:0,width:"50%",marginBottom:"20px",marginLeft:"5px"},children:" \ud83e\udca1 "})]}),Object(S.jsxs)("div",{style:{backgroundColor:"darkslategrey",borderRadius:"5px",marginTop:0,padding:"5px"},children:[Object(S.jsx)("p",{style:{fontSize:"14px",fontWeight:"700"},children:" History "}),Object(S.jsxs)("p",{style:{fontSize:"12px"},children:[this.props.history.map((function(e,n){return Object(S.jsx)("li",{children:t.printGame(n)},n)})),0===this.props.history.length&&Object(S.jsx)("li",{children:"No games yet"},"0")]})]})]})}}]),n}(a.Component),B=n(95),R=n.n(B),A=(n(175),function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).onFocus=function(){a.props.fetchChatters().then((function(t){a.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{chatters:t})}))}))},a.onSelect=function(t){a.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{selected:t.split("@").map((function(t){return t.trim()}))})}))},a.state={chatters:[],selected:[]},a}return Object(u.a)(n,[{key:"render",value:function(){var t=this;return Object(S.jsx)(R.a,{options:this.state.chatters.filter((function(e){return!t.state.selected.includes(e)})),style:{width:"200px",height:"60px",fontFamily:"sans-serif"},onFocus:this.onFocus,onSelect:this.onSelect})}}]),n}(a.Component)),P=n(176),I=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).addGame=function(t,e){a.setState((function(n){return Object(b.a)(Object(b.a)({},n),{},{messages:Object(b.a)(Object(b.a)({},a.state.messages),{},Object(f.a)({},t,{username:e,time:Date.now(),locked:!1,chosen:!1})),counter:a.state.counter+1})}))},a.toggleLock=function(t){var e=Object(b.a)({},a.state.messages[t]);e.locked=!e.locked,a.setState((function(){return Object(b.a)(Object(b.a)({},a.state),{},{messages:Object(b.a)(Object(b.a)({},a.state.messages),{},Object(f.a)({},t,e))})}))},a.onGameChosen=function(t){0!==Object.keys(a.state.messages).length&&(a.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{messages:Object(b.a)(Object(b.a)({},e.messages),{},Object(f.a)({},t,Object(b.a)(Object(b.a)({},e.messages[t]),{},{chosen:!0})))})})),a.state.messages[t].locked||setTimeout((function(){a.removeGame(t,!0)}),2500),a.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{history:[].concat(Object(m.a)(a.state.history),[t])})})))},a.removeGame=function(t){var e=Object(b.a)({},a.state.messages);delete e[t],a.setState((function(t){return Object(b.a)(Object(b.a)({},t),{},{messages:e,counter:a.state.counter+1})}))},a.onMessage=function(t,e,n){a.chatActivity.updateLastMessageTime(e)},a.chatActivity=new w(a.props.channel),a.state={messages:{},colors:P({count:99,luminosity:"light",hue:"blue"}),counter:0,history:[]},a}return Object(u.a)(n,[{key:"render",value:function(){var t=this,e=Object.keys(this.state.messages);return Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsx)(F,{addGame:this.addGame,messages:this.state.messages,channel:this.props.channel,access_token:this.props.access_token,onMessage:this.onMessage,onDelete:this.removeGame,ref:function(e){return t.messageHandler=e}}),Object(S.jsxs)("column",{width:"50vw",children:[Object(S.jsx)("h2",{style:{marginBottom:"0"},children:"Game Requests"}),Object(S.jsxs)("h4",{style:{fontSize:"20px",color:"yellow",marginTop:"6px",marginBottom:"12px",fontWeight:400},children:['Type e.g. "!request Blather Round" in ',this.props.channel,"'s chat to add"]}),Object(S.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",height:"100%"},children:[Object(S.jsx)(z,{history:this.state.history}),Object(S.jsx)("div",{style:{flexGrow:"2",marginLeft:"15px"},children:e.map((function(e,n){return Object(S.jsx)(M,{msg:e,metadata:t.state.messages[e],onDelete:t.removeGame,toggleLock:t.toggleLock.bind(e),getActivity:t.chatActivity.getStatus},n)}))})]})]}),Object(S.jsx)("column",{width:"50vw",style:{textTransform:"capitalize"},children:Object(S.jsx)("div",{style:{fontSize:"16px",overflow:"hidden",width:"600px"},children:Object(S.jsx)(g.a,{segments:e,segColors:this.state.colors,onFinished:this.onGameChosen,isOnlyOnce:!1,size:250,upDuration:100,downDuration:1e3,primaryColor:"white",contrastColor:"black"},this.state.counter)})}),Object(S.jsx)(A,{fetchChatters:this.chatActivity.getChatters})]})}}]),n}(a.Component),J=n(6),W=n(96),E=n.n(W),H=n(39),U=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(){var t;return Object(o.a)(this,n),(t=e.call(this)).state={username:"",access_token:"",failed_login:!1},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=Object(j.a)(p.a.mark((function t(){var e,n=this;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=E.a.parse(this.props.location.search),t.next=3,H("https://id.twitch.tv/oauth2/token?"+new URLSearchParams({grant_type:"authorization_code",code:e.code,client_id:"u172q64ekv1j8nxy1r48mb8vn4kk7v",client_secret:"7yfmbc5ka6t7frki5g8m0qsboltp2p",redirect_uri:"https://asukii314.github.io/twitch-request-wheel/#"}),{method:"POST",headers:{Accept:"application/vnd.twitchtv.v5+json"}}).then((function(t){return t.json()})).then((function(t){t.access_token?(n.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{access_token:t.access_token})})),H("https://api.twitch.tv/helix/users",{headers:{"Client-ID":"u172q64ekv1j8nxy1r48mb8vn4kk7v",Authorization:"Bearer ".concat(t.access_token)}}).then((function(t){return t.json()})).then((function(t){n.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{username:t.data[0].login})}))}))):n.setState((function(t){return Object(b.a)(Object(b.a)({},t),{},{failed_login:!0})}))}));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return Object(S.jsx)("div",{children:this.state.failed_login&&"/gamelist"!==this.props.location.pathname?Object(S.jsx)(J.a,{to:"/login"}):this.state.username&&Object(S.jsx)(I,{channel:this.state.username,access_token:this.state.access_token})})}}]),n}(a.Component),X=Object(J.f)(U),Y=(n(184),n(39)),K=function(t){var e=Object.keys(t.metadata);return Object(S.jsxs)("div",{className:"partyPackCard",children:[Object(S.jsxs)("p",{className:"partyPackName",children:[t.partyPackName," "]}),e.map((function(e,n){return Object(S.jsx)(Q,{gameName:e,possibleMatches:t.metadata[e]},n)}))]})},Q=function(t){return console.log(t.possibleMatches),Object(S.jsxs)("div",{children:[Object(S.jsxs)("p",{className:"gameName",children:[t.gameName," "]}),t.possibleMatches.map((function(t,e){return Object(S.jsxs)("li",{className:"possibleGameMatch",children:["!request ",t]})}))]})},V=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).state={validGames:[]},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(t){var e=this;Y(q).then((function(t){return t.text()})).then((function(t){e.setState((function(e){return Object(b.a)(Object(b.a)({},e),{},{validGames:_.a.parse(t)})}))}))}},{key:"render",value:function(){var t=this,e=Object.keys(this.state.validGames);return console.log(e),Object(S.jsx)("div",{className:"partyPackList",children:e.map((function(e,n){return Object(S.jsx)(K,{partyPackName:e,metadata:t.state.validGames[e]},n)}))})}}]),n}(a.Component),Z=function(){var t="https://id.twitch.tv/oauth2/authorize?client_id=".concat("u172q64ekv1j8nxy1r48mb8vn4kk7v","&response_type=code&scope=chat:read chat:edit&redirect_uri=").concat("https://asukii314.github.io/twitch-request-wheel/%23");return Object(S.jsx)("a",{href:t,style:{backgroundColor:"rebeccapurple",borderRadius:"5px",padding:"10px",color:"white"},children:"Log In With Twitch"})},$=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return Object(S.jsx)(r.b,{basename:"/",children:Object(S.jsx)("div",{className:"App",children:Object(S.jsxs)("header",{className:"App-header",children:[Object(S.jsx)(J.b,{exact:!0,path:"/login",children:Z()}),Object(S.jsx)(J.b,{path:"/",component:X}),Object(S.jsx)(J.b,{path:"/gamelist",component:V})]})})})}}]),n}(a.Component),tt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,188)).then((function(e){var n=e.getCLS,a=e.getFID,s=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),a(t),s(t),c(t),i(t)}))};i.a.render(Object(S.jsx)(s.a.StrictMode,{children:Object(S.jsx)(r.a,{children:Object(S.jsx)($,{})})}),document.getElementById("root")),tt()},70:function(t,e){}},[[185,1,2]]]);
//# sourceMappingURL=main.c67155de.chunk.js.map